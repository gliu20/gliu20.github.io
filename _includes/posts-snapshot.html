
{% capture post_image_urls %}
{% include posts-image-grabber.html
posts=include.posts
use_post_index=include.use_post_index
%}
{% endcapture %}

{% capture new_line %}
{% endcapture %}

{% assign post_image_urls = post_image_urls | strip | split: new_line %}

{% unless include.posts.size == 0 %}
<section class="section">
    <div class="container">
        <h2 class="title heading is-6 has-text-centered">{{ include.heading }}</h2>
        <div class="columns">

            {% for item in include.posts %}

            {% assign post = "" %}
            {% if include.use_post_index %}
                {% for candidate in site.posts %}
                    {% assign candidate_index = item | plus: 0 %}
                    {% if forloop.index0 == candidate_index %}
                        {% assign post = candidate %}
                        {% break %}
                    {% endif %}
                {% endfor %}
            {% else %}
                {% assign post = item %}
            {% endif %}

            {% assign item_post_image_url = post_image_urls[forloop.index0] | strip_newlines %}
            <div class="column is-flex">
                <a class="card is-hover-card is-flex-grow-1 is-flex-shrink-1" href="{{ item.url }}">
                    <div class="card-image">
                        <figure class="image is-4by3">
                            <img class="is-smart" loading="lazy" src="{{ item.image | default: item_post_image_url }}"
                             alt="Cover photo for {{ item.title }}">
                        </figure>
                    </div>
                    <div class="card-content">
                        <div class="block">
                            <p class="title is-4">{{ item.title }}</p>
                            <p class="subtitle is-6">
                                <time datetime="{{ item.date }}">{{ item.date | date: "%b %d, %Y" }}</time>
                            </p>
                        </div>
                        <div class="block">
                            {{ item.excerpt | strip_html | strip | default: item.description }}
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>

        {% if include.hide_view_more %}
        {% else %}
        <div class="block is-flex is-justify-content-flex-end">
            <a class="button" href="{{ include.view_more }}">View all</a>
        </div>
        {% endif %}
    </div>
</section>
{% endunless %}